<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub PR Tracker - Scrum Style</title>
    <style>
        :root {
            --color-primary: #238636;
            --color-primary-hover: #2ea043;
            --color-bg: #0d1117;
            --color-surface: #161b22;
            --color-surface-hover: #1c2128;
            --color-border: #30363d;
            --color-text: #c9d1d9;
            --color-text-secondary: #8b949e;
            --color-success: #3fb950;
            --color-warning: #d29922;
            --color-danger: #da3633;
            --color-info: #58a6ff;
            --color-purple: #a371f7;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            margin-bottom: 20px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            margin: 0 0 5px 0;
            font-size: 28px;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-desc {
            color: var(--color-text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .view-toggle {
            display: flex;
            gap: 8px;
            background: var(--color-surface);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        .view-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            font-size: 13px;
            transition: all 150ms;
        }

        .view-btn:hover {
            color: var(--color-text);
            background: var(--color-surface-hover);
        }

        .view-btn.active {
            background: var(--color-primary);
            color: white;
        }

        .search-section {
            display: grid;
            grid-template-columns: 200px 1fr 120px;
            gap: 12px;
            margin: 20px 0;
            background: var(--color-surface);
            padding: 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--color-text-secondary);
            letter-spacing: 0.5px;
        }

        input,
        select {
            padding: 10px 12px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 14px;
            font-family: inherit;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(35, 134, 54, 0.2);
        }

        button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 150ms;
            align-self: flex-end;
        }

        button:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        /* Filter Section */
        .filter-section {
            display: none;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            animation: slideDown 200ms ease-out;
        }

        .filter-section.visible {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .filter-header h3 {
            margin: 0;
            font-size: 14px;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-clear {
            font-size: 12px;
            color: var(--color-info);
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px 8px;
        }

        .filter-clear:hover {
            text-decoration: underline;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
            padding: 4px;
        }

        .filter-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 150ms;
        }

        .filter-chip:hover {
            border-color: var(--color-primary);
        }

        .filter-chip.selected {
            background: rgba(35, 134, 54, 0.2);
            border-color: var(--color-primary);
            color: var(--color-success);
        }

        .filter-chip .count {
            background: var(--color-border);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .filter-chip.selected .count {
            background: var(--color-primary);
            color: white;
        }

        /* Active Filters Display */
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .active-filter-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(88, 166, 255, 0.15);
            border: 1px solid var(--color-info);
            border-radius: 4px;
            font-size: 12px;
            color: var(--color-info);
        }

        .active-filter-tag .remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .active-filter-tag .remove:hover {
            opacity: 1;
        }

        /* Stats Section */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 200ms;
            cursor: pointer;
        }

        .stat-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .stat-card.active {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(35, 134, 54, 0.2);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Scrum View */
        .scrum-container {
            display: none;
        }

        .scrum-container.visible {
            display: block;
        }

        .scrum-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .scrum-column {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .scrum-column-header {
            padding: 15px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .scrum-column-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scrum-column-count {
            background: var(--color-bg);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .scrum-column-body {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scrum-card {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 200ms;
        }

        .scrum-card:hover {
            border-color: var(--color-primary);
            transform: translateX(3px);
        }

        .scrum-card-repo {
            font-size: 10px;
            color: var(--color-purple);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .scrum-card-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .scrum-card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .scrum-card-author {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .scrum-card-author img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .scrum-card-number {
            color: var(--color-text-secondary);
        }

        /* Daily Scrum Summary */
        .daily-summary {
            background: linear-gradient(135deg, var(--color-surface) 0%, rgba(35, 134, 54, 0.1) 100%);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .daily-summary-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .daily-summary-header h3 {
            margin: 0;
            font-size: 16px;
            color: var(--color-text);
        }

        .daily-summary-date {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .scrum-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .scrum-question {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 15px;
        }

        .scrum-question h4 {
            margin: 0 0 12px 0;
            font-size: 13px;
            color: var(--color-info);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scrum-question-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .scrum-question-list li {
            font-size: 12px;
            padding: 8px 10px;
            background: var(--color-surface);
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .scrum-question-list li::before {
            content: "‚Ä¢";
            color: var(--color-primary);
            font-weight: bold;
        }

        .scrum-question-list .pr-link {
            color: var(--color-info);
            text-decoration: none;
            font-weight: 500;
        }

        .scrum-question-list .pr-link:hover {
            text-decoration: underline;
        }

        .scrum-question-list .pr-repo-tag {
            font-size: 10px;
            background: var(--color-purple);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        .scrum-question-list .pr-status-tag {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        .scrum-question-list .status-merged {
            background: rgba(63, 185, 80, 0.2);
            color: var(--color-success);
        }

        .scrum-question-list .status-open {
            background: rgba(88, 166, 255, 0.2);
            color: var(--color-info);
        }

        .scrum-question-list .status-closed {
            background: rgba(218, 54, 51, 0.2);
            color: var(--color-danger);
        }

        /* Grid View (Original) */
        .grid-container {
            display: none;
        }

        .grid-container.visible {
            display: block;
        }

        .pr-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .pr-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
            transition: all 200ms;
            cursor: pointer;
        }

        .pr-card:hover {
            border-color: var(--color-primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .pr-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
        }

        .pr-number {
            font-size: 12px;
            color: var(--color-text-secondary);
            font-weight: 600;
        }

        .pr-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-open {
            background: rgba(88, 166, 255, 0.15);
            color: var(--color-info);
        }

        .status-merged {
            background: rgba(63, 185, 80, 0.15);
            color: var(--color-success);
        }

        .status-closed {
            background: rgba(218, 54, 51, 0.15);
            color: var(--color-danger);
        }

        .pr-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            margin: 8px 0;
            word-break: break-word;
        }

        .pr-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .pr-repo {
            background: rgba(163, 113, 247, 0.15);
            color: var(--color-purple);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .pr-author {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .pr-author img {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }

        .pr-description {
            font-size: 12px;
            color: var(--color-text-secondary);
            line-height: 1.5;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .pr-dates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--color-border);
            font-size: 11px;
        }

        .date-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .date-label {
            color: var(--color-text-secondary);
            text-transform: uppercase;
        }

        .date-value {
            color: var(--color-text);
            font-weight: 600;
        }

        /* Loading & States */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error {
            background: rgba(218, 54, 51, 0.1);
            border: 1px solid var(--color-danger);
            color: var(--color-danger);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .info-box {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid var(--color-info);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--color-info);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box a {
            color: var(--color-info);
        }

        /* Copy Button */
        .copy-summary-btn {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 8px 14px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-summary-btn:hover {
            background: var(--color-surface-hover);
            color: var(--color-text);
            border-color: var(--color-primary);
        }

        .copy-summary-btn.copied {
            border-color: var(--color-success);
            color: var(--color-success);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .scrum-board {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .search-section {
                grid-template-columns: 1fr;
            }

            .pr-list {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
            }

            h1 {
                font-size: 22px;
            }

            .scrum-questions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üìä GitHub PR Tracker</h1>
                <p class="header-desc">Track pull requests with Scrum-style standup view</p>
            </div>
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('scrum')" id="scrumViewBtn">üéØ Scrum</button>
                <button class="view-btn" onclick="switchView('grid')" id="gridViewBtn">üìã Grid</button>
            </div>
        </header>

        <div class="info-box">
            üí° <strong>Tip:</strong> For private repos, add a <a href="https://github.com/settings/tokens"
                target="_blank">Personal Access Token</a>. Use filters to focus on specific repos or contributors.
        </div>

        <div class="search-section" style="display: flex; flex-direction: column; gap: 15px;">
            <!-- Row 1: Main Search Inputs -->
            <div style="display: grid; grid-template-columns: 180px 1fr 1fr 1fr 100px; gap: 12px; align-items: end;">
                <div class="form-group">
                    <label>Token (Optional)</label>
                    <input type="password" id="token" placeholder="ghp_xxxx...">
                </div>
                <div class="form-group">
                    <label>Organization</label>
                    <input type="text" id="org" placeholder="e.g., FOSSASIA" value="FOSSASIA">
                </div>
                <div class="form-group">
                    <label>Repo Name</label>
                    <input type="text" id="repoFilter" placeholder="e.g., eventyay">
                </div>
                <div class="form-group">
                    <label>Author</label>
                    <input type="text" id="authorFilter" placeholder="e.g., arnavBallinCode">
                </div>
                <button onclick="searchPRs()">üîç Search</button>
            </div>

            <!-- Row 2: Status & Time Filters (shown after search) -->
            <div id="filterRow" style="display: none; border-top: 1px solid var(--color-border); padding-top: 12px;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <span
                        style="font-size: 11px; color: var(--color-text-secondary); text-transform: uppercase; font-weight: 600;">Status:</span>
                    <div style="display: flex; gap: 8px;" id="statusFilters">
                        <div class="filter-chip" data-filter="status" data-value="open" onclick="toggleFilter(this)">
                            üîµ Open <span class="count" id="openCount">0</span>
                        </div>
                        <div class="filter-chip" data-filter="status" data-value="merged" onclick="toggleFilter(this)">
                            üü¢ Merged <span class="count" id="mergedCount">0</span>
                        </div>
                        <div class="filter-chip" data-filter="status" data-value="closed" onclick="toggleFilter(this)">
                            üî¥ Closed <span class="count" id="closedCount">0</span>
                        </div>
                    </div>

                    <span
                        style="margin-left: 20px; font-size: 11px; color: var(--color-text-secondary); text-transform: uppercase; font-weight: 600;">Time:</span>
                    <select id="timeFilter" onchange="applyFilters()" style="padding: 6px 10px; font-size: 12px;">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>

                    <button class="filter-clear" onclick="clearFilters()" style="margin-left: auto;">Clear
                        Filters</button>
                </div>
            </div>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters" id="activeFilters"></div>

        <!-- Stats -->
        <div id="stats" class="stats" style="display: none;"></div>

        <!-- Error & Loading States -->
        <div id="error" class="error" style="display: none;"></div>
        <div id="loading" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p id="loadingText">Fetching PRs from organization...</p>
            <div class="progress-bar"
                style="width: 300px; height: 8px; background: var(--color-border); border-radius: 4px; margin: 10px auto; overflow: hidden;">
                <div id="progressFill"
                    style="width: 0%; height: 100%; background: var(--color-primary); transition: width 200ms;"></div>
            </div>
            <p id="progressText" style="font-size: 12px; color: var(--color-text-secondary);"></p>
        </div>


        <!-- Scrum View -->
        <div class="scrum-container visible" id="scrumView">
            <!-- Daily Summary -->
            <div class="daily-summary" id="dailySummary" style="display: none;">
                <div class="daily-summary-header">
                    <h3>üìù Daily Standup Summary</h3>
                    <span class="daily-summary-date" id="summaryDate"></span>
                    <button class="copy-summary-btn" onclick="copySummaryToClipboard()">
                        üìã Copy Summary
                    </button>
                </div>
                <div class="scrum-questions">
                    <div class="scrum-question">
                        <h4>üîô What did I do yesterday?</h4>
                        <ul class="scrum-question-list" id="yesterdayList"></ul>
                    </div>
                    <div class="scrum-question">
                        <h4>üìå What am I doing today?</h4>
                        <ul class="scrum-question-list" id="todayList"></ul>
                    </div>
                    <div class="scrum-question">
                        <h4>üöß Any blockers?</h4>
                        <ul class="scrum-question-list" id="blockersList"></ul>
                    </div>
                </div>
            </div>

            <!-- Scrum Board -->
            <div class="scrum-board" id="scrumBoard">
                <div class="scrum-column">
                    <div class="scrum-column-header">
                        <span class="scrum-column-title">üîµ Open / In Review</span>
                        <span class="scrum-column-count" id="openColCount">0</span>
                    </div>
                    <div class="scrum-column-body" id="openColumn"></div>
                </div>
                <div class="scrum-column">
                    <div class="scrum-column-header">
                        <span class="scrum-column-title">üü¢ Merged</span>
                        <span class="scrum-column-count" id="mergedColCount">0</span>
                    </div>
                    <div class="scrum-column-body" id="mergedColumn"></div>
                </div>
                <div class="scrum-column">
                    <div class="scrum-column-header">
                        <span class="scrum-column-title">üî¥ Closed</span>
                        <span class="scrum-column-count" id="closedColCount">0</span>
                    </div>
                    <div class="scrum-column-body" id="closedColumn"></div>
                </div>
            </div>
        </div>

        <!-- Grid View -->
        <div class="grid-container" id="gridView">
            <div id="prList" class="pr-list"></div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üîç</div>
            <h3>No pull requests found</h3>
            <p>Try a different organization or adjust your filters</p>
        </div>
    </div>

    <script>
        let allPRs = [];
        let filteredPRs = [];
        let currentView = 'scrum';
        let isLoading = false;
        let activeFilters = {
            repos: [],
            authors: [],
            status: [],
            timeRange: 'all'
        };

        // View Toggle
        function switchView(view) {
            currentView = view;
            document.getElementById('scrumViewBtn').classList.toggle('active', view === 'scrum');
            document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
            document.getElementById('scrumView').classList.toggle('visible', view === 'scrum');
            document.getElementById('gridView').classList.toggle('visible', view === 'grid');
        }

        // Search PRs with Progressive Loading
        async function searchPRs() {
            const org = document.getElementById('org').value.trim();
            const token = document.getElementById('token').value.trim();

            if (!org) {
                showError('Please enter an organization name');
                return;
            }

            // Reset state
            allPRs = [];
            filteredPRs = [];
            isLoading = true;
            showLoading(true);
            clearError();

            // Show filters immediately
            document.getElementById('filterRow').style.display = 'flex';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('stats').style.display = 'grid';

            // Filters are now in the search inputs above

            try {
                await fetchAllPRsProgressively(org, token);

                if (allPRs.length === 0) {
                    document.getElementById('emptyState').style.display = 'block';
                    document.getElementById('stats').style.display = 'none';
                    document.getElementById('dailySummary').style.display = 'none';
                    document.getElementById('scrumBoard').style.display = 'none';
                    document.getElementById('filterRow').style.display = 'none';
                }
            } catch (error) {
                showError(error.message);
                console.error('Error:', error);
            } finally {
                isLoading = false;
                showLoading(false);
                // Final update of filters
                populateFilters();
                applyFilters();
            }
        }

        async function fetchAllPRsProgressively(org, token) {
            const headers = token ? { 'Authorization': `token ${token}` } : {};
            const repoFilterValue = document.getElementById('repoFilter').value.trim().toLowerCase();
            const authorFilterValue = document.getElementById('authorFilter').value.trim().toLowerCase();

            updateProgress(0, 0, 0, 'Fetching repository list...');

            let repos = await fetchOrgRepos(org, headers);

            // Filter repos if specific repo name is provided
            if (repoFilterValue) {
                repos = repos.filter(repo =>
                    repo.name.toLowerCase().includes(repoFilterValue)
                );
                if (repos.length === 0) {
                    updateProgress(0, 0, 0, `No repos found matching "${repoFilterValue}"`);
                    return;
                }
            }

            const totalRepos = repos.length;
            let processedRepos = 0;

            updateProgress(0, totalRepos, allPRs.length, `Found ${totalRepos} repositories to process`);

            // Process repos one by one for immediate feedback
            for (const repo of repos) {
                try {
                    const prs = await fetchRepoPRs(org, repo.name, headers);
                    let mappedPRs = prs.map(pr => ({
                        ...pr,
                        repo: repo.name
                    }));

                    // Filter by author if specified
                    if (authorFilterValue) {
                        mappedPRs = mappedPRs.filter(pr =>
                            pr.user.login.toLowerCase().includes(authorFilterValue)
                        );
                    }

                    // Add to allPRs immediately
                    allPRs = allPRs.concat(mappedPRs);
                    allPRs.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));

                    processedRepos++;
                    const prCountMsg = mappedPRs.length > 0 ? ` (+${mappedPRs.length} PRs)` : '';
                    updateProgress(processedRepos, totalRepos, allPRs.length, `Processing ${repo.name}...${prCountMsg}`);

                    // Update display every few repos or when we get PRs
                    if (mappedPRs.length > 0 || processedRepos % 3 === 0) {
                        populateFilters();
                        applyFilters();
                    }

                } catch (e) {
                    console.warn(`Couldn't fetch PRs for ${repo.name}:`, e.message);
                    processedRepos++;
                    updateProgress(processedRepos, totalRepos, allPRs.length, `Skipped ${repo.name}`);
                }
            }

            updateProgress(totalRepos, totalRepos, allPRs.length, 'Complete!');
        }

        function updateProgress(current, total, prCount, message) {
            const percent = total > 0 ? Math.round((current / total) * 100) : 0;
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('loadingText').textContent = message;
            document.getElementById('progressText').textContent = `${current}/${total} repos ¬∑ ${prCount} PRs loaded`;
        }

        async function fetchOrgRepos(org, headers) {
            let allRepos = [];
            let page = 1;
            let isOrg = true;

            while (true) {
                let url = `https://api.github.com/orgs/${org}/repos?per_page=100&page=${page}`;
                let response = await fetch(url, { headers });

                if (!response.ok && page === 1) {
                    if (response.status === 404) {
                        // Try as user instead
                        isOrg = false;
                        url = `https://api.github.com/users/${org}/repos?per_page=100&page=${page}`;
                        response = await fetch(url, { headers });
                        if (!response.ok) {
                            throw new Error(`Organization/User "${org}" not found`);
                        }
                    } else if (response.status === 403) {
                        throw new Error('Rate limited. Please use a Personal Access Token.');
                    } else {
                        throw new Error(`Failed to fetch repos: ${response.statusText}`);
                    }
                } else if (!response.ok) {
                    break; // End of pagination
                }

                // For subsequent pages when it's a user
                if (!isOrg && page > 1) {
                    url = `https://api.github.com/users/${org}/repos?per_page=100&page=${page}`;
                    response = await fetch(url, { headers });
                    if (!response.ok) break;
                }

                const repos = await response.json();
                if (repos.length === 0) break;

                allRepos = allRepos.concat(repos);

                // Check if there are more pages via Link header
                const linkHeader = response.headers.get('Link');
                if (!linkHeader || !linkHeader.includes('rel="next"')) {
                    break;
                }
                page++;
            }

            return allRepos;
        }

        async function fetchRepoPRs(org, repo, headers) {
            let allPRs = [];
            let page = 1;

            while (true) {
                const url = `https://api.github.com/repos/${org}/${repo}/pulls?state=all&per_page=100&page=${page}`;
                const response = await fetch(url, { headers });

                if (!response.ok) {
                    if (page === 1) {
                        throw new Error(`Failed to fetch PRs for ${repo}: ${response.statusText}`);
                    }
                    break;
                }

                const prs = await response.json();
                if (prs.length === 0) break;

                allPRs = allPRs.concat(prs);

                // Check if there are more pages
                const linkHeader = response.headers.get('Link');
                if (!linkHeader || !linkHeader.includes('rel="next"')) {
                    break;
                }
                page++;
            }

            return allPRs;
        }

        // Author filtering is now handled by pre-search input

        // Filter Management
        function populateFilters() {
            // Repo filters
            const repos = {};
            const authors = {};

            allPRs.forEach(pr => {
                repos[pr.repo] = (repos[pr.repo] || 0) + 1;
                authors[pr.user.login] = (authors[pr.user.login] || 0) + 1;
            });

            // Sort by count
            const sortedRepos = Object.entries(repos).sort((a, b) => b[1] - a[1]);
            const sortedAuthors = Object.entries(authors).sort((a, b) => b[1] - a[1]);

            // Removed repo and author filter chips - now using pre-search inputs

            // Update status counts
            const open = allPRs.filter(pr => pr.state === 'open').length;
            const merged = allPRs.filter(pr => pr.merged_at).length;
            const closed = allPRs.filter(pr => pr.state === 'closed' && !pr.merged_at).length;

            document.getElementById('openCount').textContent = open;
            document.getElementById('mergedCount').textContent = merged;
            document.getElementById('closedCount').textContent = closed;
        }

        function toggleFilter(chip) {
            const filterType = chip.dataset.filter;
            const value = chip.dataset.value;

            chip.classList.toggle('selected');

            let filterArray;
            switch (filterType) {
                case 'repo': filterArray = activeFilters.repos; break;
                case 'author': filterArray = activeFilters.authors; break;
                case 'status': filterArray = activeFilters.status; break;
            }

            if (chip.classList.contains('selected')) {
                if (!filterArray.includes(value)) filterArray.push(value);
            } else {
                const idx = filterArray.indexOf(value);
                if (idx > -1) filterArray.splice(idx, 1);
            }

            applyFilters();
        }

        function clearFilters() {
            activeFilters = { repos: [], authors: [], status: [], timeRange: 'all' };
            document.querySelectorAll('.filter-chip.selected').forEach(chip => chip.classList.remove('selected'));
            document.getElementById('timeFilter').value = 'all';
            document.getElementById('authorSearch').value = '';
            applyFilters();
        }

        function removeFilter(type, value) {
            const idx = activeFilters[type].indexOf(value);
            if (idx > -1) activeFilters[type].splice(idx, 1);

            document.querySelectorAll(`.filter-chip[data-filter="${type.slice(0, -1)}"][data-value="${value}"]`)
                .forEach(chip => chip.classList.remove('selected'));

            applyFilters();
        }

        function applyFilters() {
            activeFilters.timeRange = document.getElementById('timeFilter').value;

            filteredPRs = allPRs.filter(pr => {
                // Repo filter
                if (activeFilters.repos.length > 0 && !activeFilters.repos.includes(pr.repo)) {
                    return false;
                }

                // Author filter
                if (activeFilters.authors.length > 0 && !activeFilters.authors.includes(pr.user.login)) {
                    return false;
                }

                // Status filter
                if (activeFilters.status.length > 0) {
                    const prStatus = pr.merged_at ? 'merged' : (pr.state === 'closed' ? 'closed' : 'open');
                    if (!activeFilters.status.includes(prStatus)) return false;
                }

                // Time filter
                const prDate = new Date(pr.updated_at);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                switch (activeFilters.timeRange) {
                    case 'today':
                        if (prDate < today) return false;
                        break;
                    case 'yesterday':
                        if (prDate < yesterday || prDate >= today) return false;
                        break;
                    case 'week':
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        if (prDate < weekAgo) return false;
                        break;
                    case 'month':
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        if (prDate < monthAgo) return false;
                        break;
                }

                return true;
            });

            updateActiveFiltersDisplay();
            displayStats();

            if (currentView === 'scrum') {
                displayScrumView();
            } else {
                displayGridView();
            }
        }

        function updateActiveFiltersDisplay() {
            const container = document.getElementById('activeFilters');
            let html = '';

            activeFilters.repos.forEach(repo => {
                html += `<div class="active-filter-tag">
                    üìÅ ${repo} <span class="remove" onclick="removeFilter('repos', '${repo}')">‚úï</span>
                </div>`;
            });

            activeFilters.authors.forEach(author => {
                html += `<div class="active-filter-tag">
                    üë§ ${author} <span class="remove" onclick="removeFilter('authors', '${author}')">‚úï</span>
                </div>`;
            });

            activeFilters.status.forEach(status => {
                html += `<div class="active-filter-tag">
                    ${status === 'open' ? 'üîµ' : status === 'merged' ? 'üü¢' : 'üî¥'} ${status} 
                    <span class="remove" onclick="removeFilter('status', '${status}')">‚úï</span>
                </div>`;
            });

            container.innerHTML = html;
        }

        function displayStats() {
            const open = filteredPRs.filter(pr => pr.state === 'open').length;
            const merged = filteredPRs.filter(pr => pr.merged_at).length;
            const closed = filteredPRs.filter(pr => pr.state === 'closed' && !pr.merged_at).length;

            const statsHTML = `
                <div class="stat-card" onclick="filterByStatus('all')">
                    <div class="stat-number">${filteredPRs.length}</div>
                    <div class="stat-label">Total PRs</div>
                </div>
                <div class="stat-card" onclick="filterByStatus('open')">
                    <div class="stat-number" style="color: var(--color-info);">${open}</div>
                    <div class="stat-label">Open</div>
                </div>
                <div class="stat-card" onclick="filterByStatus('merged')">
                    <div class="stat-number" style="color: var(--color-success);">${merged}</div>
                    <div class="stat-label">Merged</div>
                </div>
                <div class="stat-card" onclick="filterByStatus('closed')">
                    <div class="stat-number" style="color: var(--color-danger);">${closed}</div>
                    <div class="stat-label">Closed</div>
                </div>
            `;

            document.getElementById('stats').innerHTML = statsHTML;
            document.getElementById('stats').style.display = 'grid';
        }

        function filterByStatus(status) {
            if (status === 'all') {
                activeFilters.status = [];
            } else {
                activeFilters.status = [status];
            }

            // Update chip selection
            document.querySelectorAll('.filter-chip[data-filter="status"]').forEach(chip => {
                chip.classList.toggle('selected', activeFilters.status.includes(chip.dataset.value));
            });

            applyFilters();
        }

        // Scrum View
        function displayScrumView() {
            displayDailySummary();
            displayScrumBoard();
        }

        function displayDailySummary() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            // Get user's PRs (or all if no author filter)
            const targetAuthors = activeFilters.authors.length > 0 ? activeFilters.authors : null;

            // Yesterday's work: PRs updated/merged yesterday
            const yesterdayPRs = filteredPRs.filter(pr => {
                const updatedDate = new Date(pr.updated_at);
                const isYesterday = updatedDate >= yesterday && updatedDate < today;
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return isYesterday && authorMatch;
            });

            // Today's work: PRs updated today or open PRs
            const todayPRs = filteredPRs.filter(pr => {
                const updatedDate = new Date(pr.updated_at);
                const isToday = updatedDate >= today;
                const isOpen = pr.state === 'open';
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return (isToday || isOpen) && authorMatch;
            });

            // Blockers: Old open PRs (more than 7 days)
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            const blockers = filteredPRs.filter(pr => {
                const createdDate = new Date(pr.created_at);
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return pr.state === 'open' && createdDate < weekAgo && authorMatch;
            });

            document.getElementById('summaryDate').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            document.getElementById('yesterdayList').innerHTML = yesterdayPRs.length > 0
                ? yesterdayPRs.slice(0, 10).map(pr => createSummaryItem(pr)).join('')
                : '<li>No activity recorded</li>';

            document.getElementById('todayList').innerHTML = todayPRs.length > 0
                ? todayPRs.filter(p => p.state === 'open').slice(0, 10).map(pr => createSummaryItem(pr)).join('')
                : '<li>No open PRs to work on</li>';

            document.getElementById('blockersList').innerHTML = blockers.length > 0
                ? blockers.slice(0, 5).map(pr => `<li>‚ö†Ô∏è <a href="${pr.html_url}" target="_blank" class="pr-link">#${pr.number}</a> - ${escapeHtml(pr.title.substring(0, 50))}... (${daysSince(pr.created_at)} days old)</li>`).join('')
                : '<li>‚úÖ No blockers at the moment</li>';

            document.getElementById('dailySummary').style.display = 'block';
        }

        function createSummaryItem(pr) {
            const status = pr.merged_at ? 'merged' : (pr.state === 'closed' ? 'closed' : 'open');
            const statusLabel = status.charAt(0).toUpperCase() + status.slice(1);
            return `
                <li>
                    <span class="pr-repo-tag">${pr.repo}</span>
                    <a href="${pr.html_url}" target="_blank" class="pr-link">#${pr.number}</a> - 
                    ${escapeHtml(pr.title.substring(0, 40))}...
                    <span class="pr-status-tag status-${status}">${statusLabel}</span>
                </li>
            `;
        }

        function daysSince(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            return Math.floor((now - date) / (1000 * 60 * 60 * 24));
        }

        function displayScrumBoard() {
            const openPRs = filteredPRs.filter(pr => pr.state === 'open');
            const mergedPRs = filteredPRs.filter(pr => pr.merged_at);
            const closedPRs = filteredPRs.filter(pr => pr.state === 'closed' && !pr.merged_at);

            document.getElementById('openColumn').innerHTML = openPRs.slice(0, 20).map(createScrumCard).join('') || '<p style="color: var(--color-text-secondary); text-align: center; padding: 20px;">No open PRs</p>';
            document.getElementById('mergedColumn').innerHTML = mergedPRs.slice(0, 20).map(createScrumCard).join('') || '<p style="color: var(--color-text-secondary); text-align: center; padding: 20px;">No merged PRs</p>';
            document.getElementById('closedColumn').innerHTML = closedPRs.slice(0, 20).map(createScrumCard).join('') || '<p style="color: var(--color-text-secondary); text-align: center; padding: 20px;">No closed PRs</p>';

            document.getElementById('openColCount').textContent = openPRs.length;
            document.getElementById('mergedColCount').textContent = mergedPRs.length;
            document.getElementById('closedColCount').textContent = closedPRs.length;

            document.getElementById('scrumBoard').style.display = 'grid';
        }

        function createScrumCard(pr) {
            return `
                <div class="scrum-card" onclick="window.open('${pr.html_url}', '_blank')">
                    <div class="scrum-card-repo">${pr.repo}</div>
                    <div class="scrum-card-title">${escapeHtml(pr.title.substring(0, 60))}${pr.title.length > 60 ? '...' : ''}</div>
                    <div class="scrum-card-meta">
                        <div class="scrum-card-author">
                            <img src="${pr.user.avatar_url}" alt="${pr.user.login}">
                            ${pr.user.login}
                        </div>
                        <span class="scrum-card-number">#${pr.number}</span>
                    </div>
                </div>
            `;
        }

        // Grid View
        function displayGridView() {
            document.getElementById('prList').innerHTML = filteredPRs.map(pr => {
                const createdDate = new Date(pr.created_at).toLocaleDateString();
                const updatedDate = new Date(pr.updated_at).toLocaleDateString();
                const mergedOrClosedDate = pr.merged_at
                    ? new Date(pr.merged_at).toLocaleDateString()
                    : pr.closed_at
                        ? new Date(pr.closed_at).toLocaleDateString()
                        : 'N/A';

                let statusClass = 'status-open';
                let statusText = 'Open';
                if (pr.merged_at) {
                    statusClass = 'status-merged';
                    statusText = 'Merged';
                } else if (pr.state === 'closed') {
                    statusClass = 'status-closed';
                    statusText = 'Closed';
                }

                return `
                    <div class="pr-card" onclick="window.open('${pr.html_url}', '_blank')">
                        <div class="pr-header">
                            <span class="pr-number">#${pr.number}</span>
                            <span class="pr-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="pr-title">${escapeHtml(pr.title)}</div>
                        <div class="pr-meta">
                            <span class="pr-repo">${pr.repo}</span>
                            <span class="pr-author">
                                <img src="${pr.user.avatar_url}" alt="${pr.user.login}">
                                <strong>${pr.user.login}</strong>
                            </span>
                        </div>
                        ${pr.body ? `<div class="pr-description">${escapeHtml(pr.body.substring(0, 150))}</div>` : ''}
                        <div class="pr-dates">
                            <div class="date-item">
                                <span class="date-label">Created</span>
                                <span class="date-value">${createdDate}</span>
                            </div>
                            <div class="date-item">
                                <span class="date-label">${pr.merged_at ? 'Merged' : pr.closed_at ? 'Closed' : 'Updated'}</span>
                                <span class="date-value">${pr.merged_at || pr.closed_at ? mergedOrClosedDate : updatedDate}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Copy Summary
        function copySummaryToClipboard() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            const targetAuthors = activeFilters.authors.length > 0 ? activeFilters.authors : null;

            const yesterdayPRs = filteredPRs.filter(pr => {
                const updatedDate = new Date(pr.updated_at);
                const isYesterday = updatedDate >= yesterday && updatedDate < today;
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return isYesterday && authorMatch;
            });

            const todayPRs = filteredPRs.filter(pr => {
                const updatedDate = new Date(pr.updated_at);
                const isToday = updatedDate >= today;
                const isOpen = pr.state === 'open';
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return (isToday || isOpen) && authorMatch;
            }).filter(p => p.state === 'open');

            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            const blockers = filteredPRs.filter(pr => {
                const createdDate = new Date(pr.created_at);
                const authorMatch = !targetAuthors || targetAuthors.includes(pr.user.login);
                return pr.state === 'open' && createdDate < weekAgo && authorMatch;
            });

            let summary = `üìù Daily Standup - ${now.toLocaleDateString()}\n\n`;

            summary += `1. What did I do yesterday?\n`;
            if (yesterdayPRs.length > 0) {
                yesterdayPRs.forEach(pr => {
                    const status = pr.merged_at ? 'merged' : (pr.state === 'closed' ? 'closed' : 'open');
                    summary += `(${pr.repo}) - Updated PR (#${pr.number}) - ${pr.title} ${status}\n`;
                });
            } else {
                summary += `No activity recorded\n`;
            }

            summary += `\n2. What do I plan to do today?\n`;
            if (todayPRs.length > 0) {
                todayPRs.forEach(pr => {
                    summary += `(${pr.repo}) - Working on PR (#${pr.number}) - ${pr.title}\n`;
                });
            } else {
                summary += `No open PRs to work on\n`;
            }

            summary += `\n3. What is blocking me from making progress?\n`;
            if (blockers.length > 0) {
                blockers.forEach(pr => {
                    summary += `(${pr.repo}) - PR (#${pr.number}) - ${pr.title} - ${daysSince(pr.created_at)} days old\n`;
                });
            } else {
                summary += `No Blocker at the moment\n`;
            }

            navigator.clipboard.writeText(summary).then(() => {
                const btn = document.querySelector('.copy-summary-btn');
                btn.classList.add('copied');
                btn.innerHTML = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = 'üìã Copy Summary';
                }, 2000);
            });
        }

        // Utility Functions
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = '‚ùå ' + message;
            errorDiv.style.display = 'flex';
        }

        function clearError() {
            document.getElementById('error').style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        window.addEventListener('load', () => {
            searchPRs();
        });
    </script>
</body>

</html>